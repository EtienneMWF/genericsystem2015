<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">

<script src="http://code.jquery.com/jquery-2.2.0.min.js"></script>

<script type="text/javascript">
	var wsocket;
	var serviceLocation = "ws://127.0.0.1:8082/Engine";

	function getSubString(bytes,start,end){
		subString='';
		for (var i = start; i < end; i++) {
			subString += String.fromCharCode(bytes[i]);
		}
		return subString;
	}
	
	function onMessageReceived(evt) {
		
		var
		bytes = new Uint8Array(evt.data),
		length = bytes.length,
		parentId = getSubString(bytes,0,10),
		nodeId =  getSubString(bytes,10,20),
		tagHtml = getSubString(bytes,20,length);

		var root = document.getElementById("root");
		var parent = document.getElementById(parentId);
		if (parent == null) {
			parent = document.createElement("div");
			parent.setAttribute("id", parentId);
			root.insertBefore(parent,null);
		}
			
		var nodeType = nodeId.charAt(0);
		var elt = document.getElementById(nodeId);
		if(nodeType=='d')
		{
			elt = document.createElement('div');
			elt.setAttribute("id", nodeId);
		}else
			elt = document.createTextNode(tagHtml);
		alert(elt);
		parent.insertBefore(elt,null);
		
		sendMessage();
	}

	function connect() {
		wsocket = new WebSocket(serviceLocation);
		wsocket.binaryType = "arraybuffer";
		wsocket.onmessage = onMessageReceived;
	}

	function leave() {
		wsocket.close();
	}

	$(document).ready(function() {
		connect();
	});

	function sendMessage() {
		var methodId = new Uint32Array(1);
		methodId[0] = 19;
		var opId = new Uint32Array(1);
		opId[0] = 12789;
		wsocket.send(new Blob([ methodId, opId ]));
	}
</script>
</head>
<body id="root">

</body>
</html>
